# 差分

> 本文章用来记录Acwing蓝桥杯课程学习。
>
> 网站地址：https://www.acwing.com/

## 503.借教室

> 视频讲解链接：https://www.acwing.com/video/5336/

在大学期间，经常需要租借教室。

大到院系举办活动，小到学习小组自习讨论，都需要向学校申请借教室。

教室的大小功能不同，借教室人的身份不同，借教室的手续也不一样。 

面对海量租借教室的信息，我们自然希望编程解决这个问题。

我们需要处理接下来 $n$天的借教室信息，其中第 $i$ 天学校有 $r_i$ 个教室可供租借。

共有 $m$ 份订单，每份订单用三个正整数描述，分别为 $d_j,s_j,t_j$，表示某租借者需要从第 $s_j$ 天到第 $t_j$ 天租借教室（包括第 $s_j$天和第$t_j$ 天），每天需要租借$d_j$ 个教室。 

我们假定，租借者对教室的大小、地点没有要求。

即对于每份订单，我们只需要每天提供 $d_j$个教室，而它们具体是哪些教室，每天是否是相同的教室则不用考虑。 

借教室的原则是先到先得，也就是说我们要按照订单的先后顺序依次为每份订单分配教室。

如果在分配的过程中遇到一份订单无法完全满足，则需要停止教室的分配，通知当前申请人修改订单。

这里的无法满足指从第 $s_j$天到第 $t_j$ 天中有至少一天剩余的教室数量不足 $d_j$ 个。 

现在我们需要知道，是否会有订单无法完全满足。

如果有，需要通知哪一个申请人修改订单。

#### 输入格式

第一行包含两个正整数 $n,m$，表示天数和订单的数量。 

第二行包含 $n$ 个正整数，其中第 $i$ 个数为  $r_i$，表示第 $i$天可用于租借的教室数量。 

接下来有 $m$ 行，每行包含三个正整数 $d_j,s_j,t_j$，表示租借的数量，租借开始、结束分别在第几天。 

每行相邻的两个数之间均用一个空格隔开。

天数与订单均用从 $1$ 开始的整数编号。

#### 输出格式

如果所有订单均可满足，则输出只有一行，包含一个整数 $0$。

否则（订单无法完全满足）输出两行，第一行输出一个负整数 $−1$，第二行输出需要修改订单的申请人编号。

#### 数据范围

$1≤n,m≤10^6,$

$0≤r_i,d_j≤10^9,$

$1≤s_j≤t_j≤n$

#### 输入样例：

```
4 3
2 5 4 3
2 1 3
3 2 4
4 2 4
```

#### 输出样例：

```
-1
2
```

| 难度：**简单**                                               |
| ------------------------------------------------------------ |
| 时/空限制：1s / 128MB                                        |
| 总通过数：6205                                               |
| 总尝试数：19636                                              |
| 来源：[NOIP2012提高组](https://www.acwing.com/problem/search/1/?search_content=NOIP2012提高组&source_file_id=4054&show_algorithm_tags=0) |
| 算法标签                                                     |

#### 思路：



> 刚开始使用的暴力破解，但由于测试用例数据过大超时了:cry:，可以先看看补充那部分，补充有分析题目对应的时间复杂度分析。
>
> 因为题目要求没有满足条件要输出第一个没有满足的订单的的编号，第一时间想到的是可以根据订单的编号进行依次遍历，从第一份订单到最后一份订单，如果有一份订单没有满足就输出，没有则继续。但这样可能会TLE(Time Limit Exceeded),因此需要进行优化，而遍历寻找某一不满足条件的订单其实就相当于将这份订单分为两部分，这一份订单前的都能满足，订单后的都不能满足，其实就相当于二分查找第一个不满足条件的订单，因此使用二分查找优化。
>
> 
>
> 要判断执行到某一订单$j$时是否满足条件则需要设计一个check函数，如果使用$a[i]$来代表第$i$天$j$订单及之前的订单在这一天要租借的教室的总数量，那么问题其实就可以转化为先求出每一天要租借的教室的总数量$a[i]$，将$a[i]$跟这一天可以被租借的教室的数量$w[i]$对比：
>
> + 如果某一天要租借的教室的数量$a[i]>$可以被租借的教室的数量$w[i]$，就说明没有满足订单，输出$-1$和订单编号；
> + 如果某一天要租借的教室的数量$a[i]<=$可以被租借的教室的数量$w[i]$，则继续比较下一天的数量。
>
> 求解$a[i]$其实只需要给数组$a[i]$依次加上所有订单在这一天要租借的教室的数量$d_j$即可，我们要得到第$1$天到第$n$天每一天要租借的教室的数量$a[i]$，其实就相当于给每一份订单对应的第$s$ ~ $t$天的教室数量$a[s]$ ~ $a[t]$都加上这份订单要租借的教室的数量$d_j$，这就运用到了差分的知识，给$a[s]$ ~ $a[t]$都加上$d_j$其实就相当于让对应的差分数组的$b[s]+d_j，b[t+1]-d_j$ 。
>
> 接下来便可以开始编写代码。

#### 代码：

```c++
#include<iostream>
#include<cstring>
#include<algorithm>

using namespace std;
typedef long long LL;


const int N =1e6+10;
int n,m;//天数和订单数量
int w[N];//可以被租借的教室的数量
int d[N],s[N],t[N];//订单要租借的天数、租借起始时间和结束时间

LL b[N];//差分数组


/**
 * 检查处理订单mid时是否能租借成功
 * @param  mid 订单编号
 * @return  是否能租借成功 true: 能 false: 不能
 */
bool check(int mid)
{
    //初始化差分数组
	memset(b,0,sizeof b);

    //构建差分数组
	for(int i=1;i<=mid;i++)
	{
		b[s[i]]+=d[i];
		b[t[i]+1]-=d[i];
	}

	//a1=b1
	//a2=b1+b2
	//an=b1+b2+...+bn
	LL s =0;//a[i],第i天所有订单要租借的教室的数量
	for(int i=1;i<=n;i++)
	{
		s+= b[i];
		if(s >w[i]) return false;//将这一天所有订单要租借的教室的数量与这一天可以被租借的的教室的数量对比
	}
	return true;
}


int main()
{
	scanf("%d%d",&n,&m);
	for (int i = 1; i <= n; i++) scanf("%d",&w[i]);
	for (int i = 1; i <= m; i++) scanf("%d%d%d",&d[i],&s[i],&t[i]);

	//二分查找
	int l=0,r=m;
	while(l<r)
	{
		int mid=l+r+1>>1;
		if(check(mid)) l=mid;
		else r=mid-1;
	}

	//如果满足r==m，说明l=r=m，所有订单都能满足
	if(r==m) puts("0");
	else printf("-1\n%d\n",r+1);
	return 0;
}
```

## 补充：

<img src="https://voyager0587.oss-cn-guangzhou.aliyuncs.com/%E7%AC%94%E8%AE%B0%E5%9B%BE%E7%89%87/202403032231017.png" alt="image-20240303223056223" style="zoom:80%;" />









